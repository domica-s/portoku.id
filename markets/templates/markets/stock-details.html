{% extends 'markets/base/base.html' %}

{% load static %}

{% block title %}Portoku.id - {{ name }}{% endblock %}

{% block site_css %}
    <link rel="stylesheet" href="{% static 'markets/styles/stock-details.css' %}">
{% endblock %}

{% block content %}
    <body>
        <img src="data:image/png;base64,{{ data }}" alt="{{ name }} - chart" height="300", width="400">
    </body>
    <section>
        <p>Below are the details of <strong>{{ name }}</strong></p>
        <p><small>{{ fullname }}</small></p>
        <p id="price">{{ price }}</p>
        <p>{{ description }}</p>
    </section>
{% endblock %}

{% block javascript %}
    <script>
        var interval = 1000 * 60 * 5;
        var webSlug = "{{ name }}"
        $(document).ready(function() {
            setInterval(function() {
                $.ajax({
                    type: 'POST',
                    url: '{% url 'getUpdatedStockPrice' %}',
                    data: {
                     'slug': webSlug,
                     'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        $("#price").empty();
                        $("#price").append(response['price']);
                    },
                    error: function(response) {
                        alert("An error occured: " + response);
                    }
                });
            }, interval);
        })
    </script>
{% endblock %}

